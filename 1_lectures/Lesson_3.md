## **–õ–µ–∫—Ü–∏—è 6: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü ‚Äî JOIN –≤ PostgreSQL**

### **1. –í–≤–µ–¥–µ–Ω–∏–µ**

–í —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã—Ö –±–∞–∑–∞—Ö –¥–∞–Ω–Ω—ã—Ö –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ —Å—Ö–µ–º–µ `bookings` –µ—Å—Ç—å:

- `bookings.bookings` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è—Ö.
- `bookings.airports_data` ‚Äî –¥–∞–Ω–Ω—ã–µ –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤.
- `bookings.flights` ‚Äî –¥–∞–Ω–Ω—ã–µ –æ —Ä–µ–π—Å–∞—Ö.
- `bookings.ticket_flights` ‚Äî –±–∏–ª–µ—Ç—ã –Ω–∞ —Ä–µ–π—Å—ã.
- `bookings.boarding_passes` ‚Äî –ø–æ—Å–∞–¥–æ—á–Ω—ã–µ —Ç–∞–ª–æ–Ω—ã.

–ß–∞—Å—Ç–æ –Ω–∞–º –Ω—É–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü. SQL –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —ç—Ç–æ–≥–æ ‚Äî **JOIN**.

---

### **2. –í–∏–¥—ã JOIN**

#### **2.1 INNER JOIN ‚Äî –¢–æ–ª—å–∫–æ —Å–æ–≤–ø–∞–¥–∞—é—â–∏–µ –∑–∞–ø–∏—Å–∏**

INNER JOIN –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ —Å—Ç—Ä–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏–º–µ—é—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö.

–ü—Ä–∏–º–µ—Ä: –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π —Å –±–∏–ª–µ—Ç–∞–º–∏ –∏ –∏—Ö —Å—Ç–æ–∏–º–æ—Å—Ç—å—é.

```sql
SELECT t.book_ref, t.ticket_no, b.book_date
FROM bookings.bookings b
INNER JOIN bookings.tickets t ON b.book_ref = t.book_ref 
```

üìå **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**

- PostgreSQL —Å–æ–µ–¥–∏–Ω—è–µ—Ç `bookings.bookings` –∏ `bookings.ticket_flights` –ø–æ `book_ref = ticket_no`.
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–∏, —É –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ.

üìå **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?**

- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, —É –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å –±–∏–ª–µ—Ç).

---

#### **2.2 LEFT JOIN ‚Äî –í—Å–µ –∏–∑ –ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã, –ø–ª—é—Å —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è**

–≠—Ç–æ—Ç JOIN –±–µ—Ä–µ—Ç **–≤—Å–µ —Å—Ç—Ä–æ–∫–∏** –∏–∑ –ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã –∏ –¥–æ–ø–æ–ª–Ω—è–µ—Ç –∏—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º–∏ –∏–∑ –ø—Ä–∞–≤–æ–π.

–ü—Ä–∏–º–µ—Ä: –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –∏, –µ—Å–ª–∏ –µ—Å—Ç—å, –Ω–æ–º–µ—Ä–∞ —Ä–µ–π—Å–æ–≤ –ø–æ –±–∏–ª–µ—Ç–∞–º.

```sql
SELECT t.book_ref, t.ticket_no, b.book_date
FROM bookings.bookings b
LEFT JOIN bookings.tickets t ON b.book_ref = t.book_ref;
```

üìå **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**

- PostgreSQL –±–µ—Ä–µ—Ç **–≤—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è** (`bookings.bookings`).
- –ï—Å–ª–∏ —É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –µ—Å—Ç—å –±–∏–ª–µ—Ç, –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç `flight_id`.
- –ï—Å–ª–∏ –±–∏–ª–µ—Ç–∞ –Ω–µ—Ç, –≤ `flight_id` –±—É–¥–µ—Ç `NULL`.

üìå **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?**

- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π.

---

#### **2.3 RIGHT JOIN ‚Äî –í—Å–µ –∏–∑ –ø—Ä–∞–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã, –ø–ª—é—Å —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è**

–≠—Ç–æ –∑–µ—Ä–∫–∞–ª—å–Ω—ã–π —Å–ª—É—á–∞–π `LEFT JOIN`.

–ü—Ä–∏–º–µ—Ä: –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –±–∏–ª–µ—Ç—ã –∏, –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏.

```sql
SELECT t.ticket_no, t.book_ref, b.book_date
FROM bookings.tickets t
RIGHT JOIN bookings.bookings b ON b.book_ref = t.book_ref;
```

üìå **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?**

- –ö–æ–≥–¥–∞ –≤–∞–∂–Ω—ã **–≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏–∑ –ø—Ä–∞–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã**, –¥–∞–∂–µ –µ—Å–ª–∏ –≤ –ª–µ–≤–æ–π –Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π.

---

#### **2.4 FULL JOIN ‚Äî –í—Å–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü**

–≠—Ç–æ—Ç —Ç–∏–ø —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –±–µ—Ä–µ—Ç **–≤—Å–µ —Å—Ç—Ä–æ–∫–∏** –∏–∑ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü. –ï—Å–ª–∏ –Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π ‚Äî –≤—Å—Ç–∞–≤–ª—è–µ—Ç `NULL`.

–ü—Ä–∏–º–µ—Ä: –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤—Å–µ –±–∏–ª–µ—Ç—ã (–¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ—Ç —Å–≤—è–∑–∏).

```sql
SELECT b.book_ref, t.ticket_no, b.book_date
FROM bookings.bookings b
FULL JOIN bookings.tickets t ON b.book_ref = t.book_ref;
```

üìå **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?**

- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å **–≤—Å–µ –¥–∞–Ω–Ω—ã–µ** –∏–∑ –¥–≤—É—Ö —Ç–∞–±–ª–∏—Ü.

---

### **3. –ö–∞–∫ –∑–∞–¥–∞–≤–∞—Ç—å —É—Å–ª–æ–≤–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è?**

#### **3.1 ON ‚Äî —è–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ —É—Å–ª–æ–≤–∏–π**

–ß–∞—â–µ –≤—Å–µ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–µ–ª–∞—é—Ç—Å—è –ø–æ `ON`, —É–∫–∞–∑—ã–≤–∞—è, –∫–∞–∫–∏–µ —Å—Ç–æ–ª–±—Ü—ã —Å–≤—è–∑–∞–Ω—ã.

–ü—Ä–∏–º–µ—Ä: –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ä–µ–π—Å–æ–≤ —Å –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞–º–∏ –≤—ã–ª–µ—Ç–∞ –∏ –ø—Ä–∏–±—ã—Ç–∏—è.

```sql
SELECT f.flight_no, f.scheduled_departure, a1.airport_name AS departure_airport, a2.airport_name AS arrival_airport
FROM bookings.flights f
JOIN bookings.airports a1 ON f.departure_airport = a1.airport_code
JOIN bookings.airports a2 ON f.arrival_airport = a2.airport_code;
```

üìå **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ON?**

- –ö–æ–≥–¥–∞ —Å–æ–µ–¥–∏–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—ã –ø–æ —Ä–∞–∑–Ω—ã–º —Å—Ç–æ–ª–±—Ü–∞–º.

---

#### **3.2 USING ‚Äî —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç ON**

–ï—Å–ª–∏ –∏–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫ –≤ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö **—Å–æ–≤–ø–∞–¥–∞—é—Ç**, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `USING`.

–ü—Ä–∏–º–µ—Ä:

```sql
SELECT t.book_ref, t.ticket_no, b.book_date
FROM bookings.bookings b
LEFT JOIN bookings.tickets t USING (book_ref)
```

üìå **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?**

- –ï—Å–ª–∏ –∫–ª—é—á–∏ –≤ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö **–Ω–∞–∑—ã–≤–∞—é—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ**.

---

### **4. –ü–æ–¥–∑–∞–ø—Ä–æ—Å—ã –∏ CTE –≤ JOIN**

#### **4.1 –ü–æ–¥–∑–∞–ø—Ä–æ—Å –≤ JOIN**

–ò–Ω–æ–≥–¥–∞ —É–¥–æ–±–Ω–µ–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–µ.

–ü—Ä–∏–º–µ—Ä: –ù–∞–π—Ç–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –ø–æ –∫–∞–∂–¥–æ–º—É –∞—ç—Ä–æ–ø–æ—Ä—Ç—É –≤—ã–ª–µ—Ç–∞.

```sql
SELECT a.airport_name, b.booking_count
FROM bookings.airports a
LEFT JOIN (
    SELECT f.departure_airport, COUNT(*) AS booking_count
    FROM bookings.flights f
    JOIN bookings.ticket_flights tf ON f.flight_id = tf.flight_id
    GROUP BY f.departure_airport
) b ON a.airport_code = b.departure_airport;
```

---

#### **4.2 CTE (Common Table Expressions) –≤ JOIN**
_–æ–±–æ–±—â–µ–Ω–Ω–æ–µ —Ç–∞–±–ª–∏—á–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ_
CTE (`WITH`) –¥–µ–ª–∞–µ—Ç SQL-–∫–æ–¥ **—á–∏—Ç–∞–µ–º–µ–µ**.

–ü—Ä–∏–º–µ—Ä: –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –æ–±—â–µ–π —Å—É–º–º–æ–π –ø–ª–∞—Ç–µ–∂–µ–π –≤—ã—à–µ 5000.

```sql
WITH total_payments AS (
    SELECT tf.ticket_no, SUM(tf.amount) AS total_spent
    FROM bookings.ticket_flights tf
    GROUP BY tf.ticket_no
)
SELECT tf.ticket_no, tp.total_spent
FROM bookings.ticket_flights tf
JOIN total_payments tp ON tf.ticket_no = tp.ticket_no
WHERE tp.total_spent > 5000;
```

---

### **5. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è JOIN**

**–ò–Ω–¥–µ–∫—Å—ã**

```sql
CREATE INDEX idx_ticket_flights_flight_id ON bookings.ticket_flights (flight_id);
```

**–§–∏–ª—å—Ç—Ä—ã –ø–µ—Ä–µ–¥ JOIN**

```sql
SELECT * FROM
(SELECT * FROM bookings.flights WHERE status = 'Scheduled') f
JOIN bookings.airports_data a ON f.departure_airport = a.airport_code;
```

**LIMIT**

```sql
SELECT * FROM bookings.flights f
JOIN bookings.airports_data a ON f.departure_airport = a.airport_code
LIMIT 1000;
```

---

### **–í—ã–≤–æ–¥—ã**

- `INNER JOIN` ‚Äî —Ç–æ–ª—å–∫–æ —Å–æ–≤–ø–∞–¥–∞—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏.
- `LEFT JOIN` ‚Äî –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ –ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã + —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è.   
- `RIGHT JOIN` ‚Äî –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ –ø—Ä–∞–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã + —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è.    
- `FULL JOIN` ‚Äî –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü.    
- `CROSS JOIN` ‚Äî **–û—Å—Ç–æ—Ä–æ–∂–Ω–æ!** –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –º–∏–ª–ª–∏–æ–Ω—ã —Å—Ç—Ä–æ–∫.    
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ JOIN-–∑–∞–ø—Ä–æ—Å—ã** —Å –ø–æ–º–æ—â—å—é –∏–Ω–¥–µ–∫—Å–æ–≤, —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ LIMIT.
- `ON` –∏ `USING` —É–ø—Ä–∞–≤–ª—è—é—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º.  
- CTE –¥–µ–ª–∞—é—Ç –∫–æ–¥ —á–∏—â–µ.  
